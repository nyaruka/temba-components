<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <title>Flow Editor Examples</title>
    <link
      href="/static/css/temba-components.css"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto+Mono:300|Roboto:300,400,500"
      rel="stylesheet"
    />
    <link href="../../styles.css" rel="stylesheet" type="text/css" />
    <style>
      .flow-list {
        max-width: 800px;
        margin: 0 auto;
        padding: 40px 20px;
      }

      .flow-card {
        background: white;
        border: 1px solid #e1e5e9;
        border-radius: 8px;
        padding: 24px;
        margin-bottom: 16px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        transition: box-shadow 0.2s ease;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .flow-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .flow-title {
        font-size: 1.5em;
        font-weight: 500;
        color: #2c3e50;
        margin: 0;
      }

      .flow-link {
        display: inline-block;
        background: #3498db;
        color: white;
        padding: 12px 24px;
        text-decoration: none;
        border-radius: 4px;
        font-weight: 500;
        transition: background-color 0.2s ease;
      }

      .flow-link:hover {
        background: #2980b9;
        color: white;
      }

      .back-link {
        display: inline-block;
        margin-bottom: 24px;
        color: #3498db;
        text-decoration: none;
      }

      .back-link:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="flow-list">
      <a href="../../index.html" class="back-link">‚Üê Back to Component Demos</a>

      <h1>Flow Editor Examples</h1>
      <p>
        Choose a flow to open in the Flow Editor. Each flow demonstrates
        different features and capabilities.
      </p>

      <div id="flow-cards">
        <div class="flow-card">
          <div class="flow-title">Loading flows...</div>
        </div>
      </div>
    </div>

    <script type="module">
      // Function to load and display flows dynamically
      async function loadFlows() {
        const flowCardsContainer = document.getElementById('flow-cards');

        try {
          // Get list of flow files from the flows directory API
          const response = await fetch('/api/flows-list');
          const files = await response.json();

          if (!Array.isArray(files) || files.length === 0) {
            // Fallback: try known flows if directory listing doesn't work
            await loadKnownFlows(flowCardsContainer);
            return;
          }

          const flows = [];

          // Load each flow file to get its definition
          for (const fileName of files) {
            const flowId = fileName.replace('.json', '');

            try {
              const flowResponse = await fetch(`/demo/data/flows/${fileName}`);
              const flowData = await flowResponse.json();
              const flowName = flowData.definition?.name || flowId;

              flows.push({
                id: flowId,
                name: flowName
              });
            } catch (error) {
              console.warn(`Failed to load flow ${fileName}:`, error);
              // Add with fallback name
              flows.push({
                id: flowId,
                name: flowId
                  .replace('-', ' ')
                  .replace(/\b\w/g, (l) => l.toUpperCase())
              });
            }
          }

          displayFlows(flows, flowCardsContainer);
        } catch (error) {
          console.warn(
            'Failed to load flows from directory, using fallback:',
            error
          );
          // await loadKnownFlows(flowCardsContainer);
        }
      }

      // Fallback function for known flows
      async function loadKnownFlows(container) {
        const knownFlows = ['sample-flow', 'food-order', 'voicemail'];
        const flows = [];

        for (const flowId of knownFlows) {
          try {
            const response = await fetch(`/demo/data/flows/${flowId}.json`);
            const flowData = await response.json();
            const flowName = flowData.definition?.name || flowId;

            flows.push({
              id: flowId,
              name: flowName
            });
          } catch (error) {
            console.warn(`Failed to load flow ${flowId}:`, error);
          }
        }

        displayFlows(flows, container);
      }

      // Function to display flows in the UI
      function displayFlows(flows, container) {
        if (flows.length === 0) {
          container.innerHTML = `
            <div class="flow-card">
              <div class="flow-title">No flows found</div>
            </div>
          `;
          return;
        }

        container.innerHTML = flows
          .map(
            (flow) => `
          <div class="flow-card">
            <div class="flow-title">${escapeHtml(flow.name)}</div>
            <a href="example.html?flow=${encodeURIComponent(
              flow.id
            )}" class="flow-link">
              Open Flow
            </a>
          </div>
        `
          )
          .join('');
      }

      // Helper function to escape HTML
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // Load flows when the page loads
      loadFlows();
    </script>
  </body>
</html>
