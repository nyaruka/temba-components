<!DOCTYPE html>
<html>
  <head>
    <title>Action Editor Demo</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script type="module" src="../out-tsc/temba-modules.js"></script>
    <link rel="stylesheet" href="styles.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .demo-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .action-box {
        background: #e8f4fd;
        border: 1px solid #3498db;
        border-radius: 6px;
        padding: 15px;
        margin: 10px 0;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .action-box:hover {
        background: #d1e7fb;
      }
      .action-type {
        font-weight: bold;
        color: #3498db;
        font-size: 0.9em;
        text-transform: uppercase;
      }
      .action-content {
        margin-top: 8px;
      }
      .quick-replies {
        margin-top: 8px;
      }
      .quick-reply {
        display: inline-block;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 4px 8px;
        margin: 2px;
        font-size: 0.8em;
      }
      pre {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 10px;
        font-size: 0.9em;
        overflow-x: auto;
      }
      .explanation {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 4px;
        padding: 15px;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <div class="demo-container">
      <h1>Action Editor Demo - Data Transformation</h1>

      <div class="explanation">
        <h3>What this demo shows:</h3>
        <p>
          Click on the "Send Message" action below to see how the ActionEditor
          handles data transformation:
        </p>
        <ul>
          <li>
            <strong>Input data</strong>: Quick replies are stored as a simple
            string array: <code>["Option 1", "Option 2"]</code>
          </li>
          <li>
            <strong>Form display</strong>: The form converts them to name/value
            objects for the temba-select component
          </li>
          <li>
            <strong>Save process</strong>: When saving, the data is converted
            back to the original string array format
          </li>
        </ul>
      </div>

      <h2>Sample Action:</h2>
      <div class="action-box" id="sampleAction">
        <div class="action-type">Send Message</div>
        <div class="action-content">
          <div><strong>Text:</strong> Hello! How can I help you today?</div>
          <div class="quick-replies">
            <strong>Quick Replies:</strong>
            <span class="quick-reply">Get Support</span>
            <span class="quick-reply">View Products</span>
            <span class="quick-reply">Contact Sales</span>
          </div>
        </div>
      </div>

      <h3>Original Action Data:</h3>
      <pre id="originalData"></pre>

      <h3>After Editing (saved data):</h3>
      <pre id="savedData"></pre>

      <temba-action-editor id="actionEditor"></temba-action-editor>
    </div>

    <script>
      // Sample action data
      const sampleAction = {
        uuid: 'demo-action-uuid',
        type: 'send_msg',
        text: 'Hello! How can I help you today?',
        quick_replies: ['Get Support', 'View Products', 'Contact Sales']
      };

      // Display original data
      document.getElementById('originalData').textContent = JSON.stringify(
        sampleAction,
        null,
        2
      );

      // Get references to elements
      const actionBox = document.getElementById('sampleAction');
      const actionEditor = document.getElementById('actionEditor');
      const savedDataElement = document.getElementById('savedData');

      // Handle clicking on the action
      actionBox.addEventListener('click', () => {
        actionEditor.action = sampleAction;
        actionEditor.nodeUuid = 'demo-node';
      });

      // Handle save event
      actionEditor.addEventListener('temba-action-saved', (event) => {
        const savedAction = event.detail.action;
        savedDataElement.textContent = JSON.stringify(savedAction, null, 2);

        // Update the display
        updateActionDisplay(savedAction);

        alert(
          'Action saved! Check the "After Editing" section to see the transformed data.'
        );
      });

      // Handle cancel event
      actionEditor.addEventListener('temba-action-edit-canceled', () => {
        console.log('Action editing was canceled');
      });

      function updateActionDisplay(action) {
        const contentDiv = actionBox.querySelector('.action-content');
        const quickRepliesDiv = contentDiv.querySelector('.quick-replies');

        // Update text
        contentDiv.querySelector(
          'div'
        ).innerHTML = `<strong>Text:</strong> ${action.text}`;

        // Update quick replies
        let quickRepliesHTML = '<strong>Quick Replies:</strong>';
        if (action.quick_replies && action.quick_replies.length > 0) {
          action.quick_replies.forEach((reply) => {
            quickRepliesHTML += `<span class="quick-reply">${reply}</span>`;
          });
        } else {
          quickRepliesHTML += ' <em>(none)</em>';
        }
        quickRepliesDiv.innerHTML = quickRepliesHTML;
      }
    </script>
  </body>
</html>
